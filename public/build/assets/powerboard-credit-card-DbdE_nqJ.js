import{i,w as u}from"./wait-BlTzaSj7.js";/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2024. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */let s=!1;function l(){const r=document.querySelector("meta[name=public_key]"),n=document.querySelector("meta[name=gateway_id]"),o=document.querySelector("meta[name=environment]"),t=document.querySelector("meta[name=supported_cards]"),e=new cba.HtmlWidget("#widget",r?.content,n?.content);if(e.setEnv(o?.content),e.useAutoResize(),t?.content)try{const c=JSON.parse(t.content);e.setSupportedCardIcons(c,!0)}catch{}e.interceptSubmitForm("#stepone"),e.onFinishInsert('#server-response input[name="gateway_response"]',"payment_source"),e.setFormFields(["card_name*"]),e.reload();let a=document.getElementById("pay-now");return a.disabled=!1,a.querySelector("svg").classList.add("hidden"),a.querySelector("span").classList.remove("hidden"),document.querySelector('#server-response input[name="gateway_response"]').value="",e}function m(){document.querySelector("#widget")?.replaceChildren(),document.querySelector("#widget")?.classList.remove("hidden"),document.querySelector("#widget-3dsecure")?.replaceChildren()}function d(){if(m(),!document.querySelector("meta[name=gateway_id]")?.content){let e=document.getElementById("pay-now");e.disabled=!0,e.querySelector("svg").classList.remove("hidden"),e.querySelector("span").classList.add("hidden"),document.getElementById("errors").textContent="Gateway not found or verified",document.getElementById("errors").hidden=!1}const n=l();n.on("finish",()=>{document.getElementById("errors").hidden=!0,y()}),n.on("submit",function(e){document.getElementById("errors").hidden=!0});let o=document.getElementById("pay-now");o.addEventListener("click",()=>{const e=document.getElementById("widget");if(n.getValidationState(),!n.isValidForm()&&e.offsetParent!==null){o.disabled=!1,o.querySelector("svg").classList.add("hidden"),o.querySelector("span").classList.remove("hidden");return}o.disabled=!0,o.querySelector("svg").classList.remove("hidden"),o.querySelector("span").classList.add("hidden");let a=document.querySelector("input[name=token-billing-checkbox]:checked");a&&(document.getElementById("store_card").value=a.value),e.offsetParent!==null?document.getElementById("stepone_submit").click():document.getElementById("server-response").submit()}),document.getElementById("toggle-payment-with-credit-card").addEventListener("click",e=>{document.getElementById("widget").classList.remove("hidden"),document.getElementById("save-card--container").style.display="grid",document.querySelector("input[name=token]").value="",document.querySelector("#powerboard-payment-container")?.classList.remove("hidden")}),Array.from(document.getElementsByClassName("toggle-payment-with-token")).forEach(e=>e.addEventListener("click",a=>{document.getElementById("widget").classList.add("hidden"),document.getElementById("save-card--container").style.display="none",document.querySelector("input[name=token]").value=a.target.dataset.token,document.querySelector("#powerboard-payment-container")?.classList.add("hidden")}));const t=document.querySelectorAll("input.toggle-payment-with-token");t.length>0&&t[0].click(),s&&document.getElementById("toggle-payment-with-credit-card")?.click()}async function y(){try{const r=await g();if(!r||!r.status||r.status==="not_authenticated"||r==="not_authenticated")throw s=!0,d(),new Error("There was an issue authenticating this payment method.");if(r.status==="authentication_not_supported"){document.querySelector('input[name="browser_details"]').value=null,document.querySelector('input[name="charge"]').value=JSON.stringify(r);let t=document.querySelector("input[name=token-billing-checkbox]:checked");return t&&(document.getElementById("store_card").value=t.value),document.getElementById("server-response").submit()}const n=new cba.Canvas3ds("#widget-3dsecure",r._3ds.token);n.load(),document.getElementById("widget").classList.add("hidden"),n.on("chargeAuthSuccess",function(t){document.querySelector('input[name="browser_details"]').value=null,document.querySelector('input[name="charge"]').value=JSON.stringify(t);let e=document.querySelector("input[name=token-billing-checkbox]:checked");e&&(document.getElementById("store_card").value=e.value),document.getElementById("server-response").submit()}),n.on("chargeAuthReject",function(t){document.getElementById("errors").textContent="Sorry, your transaction could not be processed...",document.getElementById("errors").hidden=!1,s=!0,d()}),n.load()}catch(r){const n=r.message??"Unknown error.";document.getElementById("errors").textContent=`Sorry, your transaction could not be processed...

${n}`,document.getElementById("errors").hidden=!1,s=!0,d()}}async function g(){const r={name:navigator.userAgent.substring(0,100),java_enabled:navigator.javaEnabled()?"true":"false",language:navigator.language||navigator.userLanguage,screen_height:window.screen.height.toString(),screen_width:window.screen.width.toString(),time_zone:(new Date().getTimezoneOffset()*-1).toString(),color_depth:window.screen.colorDepth.toString()};document.querySelector('input[name="browser_details"]').value=JSON.stringify(r);const n=JSON.stringify(Object.fromEntries(new FormData(document.getElementById("server-response")))),o=document.querySelector("meta[name=payments_route]");try{const t=await fetch(o.content,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json","X-CSRF-Token":document.querySelector('meta[name="csrf-token"]').content},body:n});return t.ok?await t.json():await t.json().then(e=>{throw new Error(e.message??"Unknown error.")})}catch(t){document.getElementById("errors").textContent=`Sorry, your transaction could not be processed...

${t.message}`,document.getElementById("errors").hidden=!1,s=!0,d()}}i()?d():u("#powerboard-credit-card-payment").then(()=>d());
