import{w as h}from"./wait-BlTzaSj7.js";/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2024. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */h("#stripe-ach-payment").then(()=>f());function f(){let i=document.getElementById("pay-now");i&&(Array.from(document.getElementsByClassName("toggle-payment-with-token")).forEach(e=>e.addEventListener("click",n=>{document.querySelector("input[name=source]").value=n.target.dataset.token})),i.addEventListener("click",function(){let e=document.getElementById("pay-now");e.disabled=!0,e.querySelector("svg").classList.remove("hidden"),e.querySelector("span").classList.add("hidden"),document.getElementById("server-response").submit()}));const l=document.querySelector('input[name="payment-type"]');l&&l.click(),document.getElementById("new-bank").addEventListener("click",e=>{if(!document.getElementById("accept-terms").checked){errors.textContent="You must accept the mandate terms prior to making payment.",errors.hidden=!1;return}errors.hidden=!0;let n,t=document.querySelector('meta[name="stripe-publishable-key"]').content,o=document.querySelector('meta[name="stripe-account-id"]')?.content;o?n=Stripe(t,{stripeAccount:o}):n=Stripe(t);let s=document.getElementById("new-bank");s.disabled=!0,s.querySelector("svg").classList.remove("hidden"),s.querySelector("span").classList.add("hidden"),e.preventDefault();const m=document.getElementById("account-holder-name-field"),y=document.getElementById("email-field"),d=document.querySelector('meta[name="client_secret"]')?.content;n.collectBankAccountForPayment({clientSecret:d,params:{payment_method_type:"us_bank_account",payment_method_data:{billing_details:{name:m.value,email:y.value}}},expand:["payment_method"]}).then(({paymentIntent:a,error:c})=>{if(c)console.error(c.message),errors.textContent=c.message,errors.hidden=!1,r();else if(a.status==="requires_payment_method"){errors.textContent="We were unable to process the payment with this account, please try another one.",errors.hidden=!1,r();return}else if(a.status==="requires_confirmation"){let p=document.getElementById("bank_account_response");p.value=JSON.stringify(a),u(n,d)}r()})});function u(e,n){e.confirmUsBankAccountPayment(n).then(({paymentIntent:t,error:o})=>{if(console.log(t),o)console.error(o.message);else if(t.status==="requires_payment_method")errors.textContent="We were unable to process the payment with this account, please try another one.",errors.hidden=!1,r();else if(t.status==="processing"){let s=document.getElementById("gateway_response");s.value=JSON.stringify(t),document.getElementById("server-response").submit()}else if(t.next_action?.type==="verify_with_microdeposits"||t.next_action?.type==="requires_source_action"){errors.textContent="You will receive an email with details on how to verify your bank account and process payment.",errors.hidden=!1,document.getElementById("new-bank").style.visibility="hidden";let s=document.getElementById("gateway_response");s.value=JSON.stringify(t),document.getElementById("server-response").submit()}})}function r(){let e=document.getElementById("new-bank");e.disabled=!1,e.querySelector("svg").classList.add("hidden"),e.querySelector("span").classList.remove("hidden")}}
